## SearchActivity

---
## 구현에 어려움을 겪은 부분
#### 1. Firebase에서 두가지 정보를 분류해 저장
: 사용자의 정보를 저장하는 UserInfo와 채팅방과 채팅 내용의 정보를 저장하는 ChatInfo의 성격이 다르다고 생각해 따로 구분해서 저장하고자 함   
 -> 두개의 firebase를 이용하고자 했으나 유료버전이였기 때문에 또 다른 해결 방안을 찾고자 함
``` 
 private DatabaseReference reference = FirebaseDatabase.getInstance().getReference().getRoot();
 Map<String, Object> values = toMap(master_mail, str_room);
 map.put(str_room,"");
 reference.child("ChatInfo").child(station).child(str_room).updateChildren(values);
```
: ChatInfo > 지하철역 > 방 제목 > 방장의 이메일, 방 제목   
: child()와 updateChildren()을 사용해 UserInfo와 ChatInfo는 물론 ChatInfo 안의 여러 지하철역도 분류하여 저장할 수 있게 되었음   
   
#### 2. Socket 구현   
: 방장이 "매칭 완료" 버튼을 누르면 모든 사용자(해당 채팅방의 인원들)의 화면에서는 OUT버튼이 사라지게 구현하는 것이 목표   
: btn_out.setVisibility(View.INVISIBLE)을 통해 매칭완료 버튼이 눌리면 사라지게 했지만, 다른 사용자의 화면에서는 사라지지 않음   
-> Socket을 이용한다면 방장의 화면에서는 물론, 다른 사용자의 화면에서도 OUT버튼이 사라지지 않을까?   
1) ChatActivity에 Socket 코드를 함께 구현   
 > app/src/main/java/com/example/kooktaxi/Socket/ChatActivity.java   
 : socket을 이용해 구현을 했음에도 불구하고 서버에서 받아오는 것이 제대로 되지 않아 방장의 화면에서는 matching 버튼을 누르자 OUT버튼이 사라졌으나, 다른 화면에서는 사라지지 않고 OUT버튼이 계속 존재했음   
   
2) networkclientsocket과 networkseversocket 자바 파일을 따로 만들어 구현   
- [클라이언트]networkclientsocket   
 > app/src/main/java/com/example/kooktaxi/Socket/networkclientsocket.java   
- [서버]networkseversocket   
 > app/src/main/java/com/example/kooktaxi/Socket/networkserversocket.java   
: 위와 같은 두 파일을 추가했더니 ChatActivity와의 연결이 올바르게 되지않아 오류가 계속해서 발생했음   
      
#### 3. Out버튼을 눌렀을 때의 채팅방 인원
> 채팅방에 들어오는 인원을 배열에 추가하고 OUT버튼을 눌러 나가는 인원은 배열에서 삭제하면서 인원 수 세기   
: 들어오는 인원의 수는 올바르게 세어지나 OUT버튼을 눌러 나가는 인원에 대해 수가 제대로 파악되지 않는 현상이 일어남   
1) 배열을 다른 형식으로 바꾸기    
 - [ArrayList]   
 : 들어오는 인원은 값을 제대로 불러오는데 나가는 인원에 대해서는 처음 나간 한 명만 숫자를 세고 그 뒤로는 반응하지 않음   
 : ArrayList를 쓸 때 idx에서 문제가 발생한다고 생각해 순서의 의미가 크게 없는 Set, HashSet, Vector를 사용하기로 함    
- [Set, HashSet, Vector 등]   
 : 순서에 영향이 없는 컬렉션을 사용했지만, 마찬가지로 나가는 인원에 대해서 오류가 발생함   
 : 정확한 원인을 파악하지 못해 추후에 보다 연구하여 개선해야 하는 부분   
